<MudSelect @bind-Value="_selectedSubtype"
           Variant="Variant.Filled"
           Label="Subsidy Subtype"
           Disabled="@_selectDisabled"
           Class="mt-4">
    @foreach (var subtype in _subsidySubtypes)
    {
        <MudSelectItem Value="@subtype">@subtype</MudSelectItem>
    }
</MudSelect>

@if (!string.IsNullOrWhiteSpace(_selectedSubtype))
{
    <MudText Class="mt-4" Typo="Typo.body2">
        Stage-based investment payments are subsidies that are disbursed in multiple stages or installments based on the progress of a project or investment. Farmers receive payments at specific milestones or stages of their agricultural activities, allowing them to manage cash flow and ensure the successful completion of their projects. Each stage payment is typically contingent upon meeting predefined criteria and delivering required documentation.
    </MudText>
    <MudText Class="mt-2" Typo="Typo.body2">

        Conditions:
        <ul>
            <li>At least 50% co-financing by the farmer.</li>
            <li>Max. 3 stages over 36 months.</li>
            <li>Each stage must be fully completed before the next is paid.</li>
        </ul>
    </MudText>

    @*CROP SECTOR*@
    @if (_selectedSubtype == "Crop sector")
    {
    <UploadDocument Title="Copy of the extract from the State Register of Legal Entities / copy of the registration certificate" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Declaration on own responsibility regarding the truthfulness of the information and submitted documents" ButtonText="Upload" FilesChanged="UploadFiles" /> 
    <UploadDocument Title="Proof of having a bank account in Moldovan lei (MDL), opened at a commercial bank in the Republic of Moldova" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Stage-based investment project" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Proof of relevant professional competence of the administrator or an employee" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Applicant’s commitment to contribute at least 50% of the total eligible investment cost" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Copy of the project sketch, prepared by the supplier or authorized designer, showing technical parameters" ButtonText="Upload" FilesChanged="UploadFiles" /> 
    <UploadDocument Title="Copy of the detailed cost estimate for materials and installation services" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Offers from suppliers for the goods, works, or services to be subsidized" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Copy of the perennial plantation establishment project, with attached general plan of the plantation" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Proof of legal ownership of the immovable property and/or its components where the investment will be made" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Copy of the authorization documents for the planned investment" ButtonText="Upload" FilesChanged="UploadFiles" /> 
    <UploadDocument Title="Copy of the technical project prepared by licensed companies, in case of new constructions or extensions" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Copy of the detailed cost estimate for materials and services, verified by certified technical specialists" ButtonText="Upload" FilesChanged="UploadFiles" />
    }

    @*LIVESTOCK SECTOR*@
    else if (_selectedSubtype == "Livestock sector")
    {
    <UploadDocument Title="Copy of the extract from the State Register of Legal Entities / copy of the registration certificate" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Declaration on own responsibility regarding the truthfulness of the information and submitted documents" ButtonText="Upload" FilesChanged="UploadFiles" /> 
    <UploadDocument Title="Proof of having a bank account in Moldovan lei (MDL), opened at a commercial bank in the Republic of Moldova" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Stage-based investment project" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Proof of zootechnical competence" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Applicant’s commitment to contribute at least 50% of the total eligible investment cost" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Copy of the certificate proving membership in a professional livestock association" ButtonText="Upload" FilesChanged="UploadFiles" /> 
    <UploadDocument Title="Copy of the technical project prepared by licensed companies" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Copy of the detailed cost estimate for materials and services, verified by certified specialists" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Copy of the detailed cost estimate for materials and installation services" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Offers from suppliers for the goods, works, or services to be subsidized" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Reception act, accompanied by the environmental agreement " ButtonText="Upload" FilesChanged="UploadFiles" /> 
    <UploadDocument Title="Proof of legal ownership of the immovable property and/or its components where the investment will be made" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Copy of the authorization documents for the planned investment, according to Law No. 160/2011" ButtonText="Upload" FilesChanged="UploadFiles" />
    }

    @*WINE SECTOR*@
    else if (_selectedSubtype == "Wine sector")
    {   
    <UploadDocument Title="Copy of the extract from the State Register of Legal Entities / copy of the registration certificate" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Declaration on own responsibility regarding the truthfulness of the information and submitted documents" ButtonText="Upload" FilesChanged="UploadFiles" /> 
    <UploadDocument Title="Proof of having a bank account in Moldovan lei (MDL), opened at a commercial bank in the Republic of Moldova" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Stage-based investment project" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Proof of viticulture-related competence" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Proof of membership in a wine producers’ association with protected geographical indication or designation of origin" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Applicant’s commitment to contribute at least 50% of the total eligible investment cost" ButtonText="Upload" FilesChanged="UploadFiles" /> 
    <UploadDocument Title="Copy of the technical project prepared by licensed companies" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Copy of the detailed cost estimate for materials and services, verified by authorized specialists" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Offers from suppliers for the goods, works, or services to be subsidized" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Copy of the vineyard establishment project, with attached general plan" ButtonText="Upload" FilesChanged="UploadFiles" />
    <UploadDocument Title="Proof of legal ownership of the immovable property and/or its components where the investment will be made" ButtonText="Upload" FilesChanged="UploadFiles" /> 
    <UploadDocument Title="Copy of the authorization documents for the planned investment, according to Law No. 160/2011" ButtonText="Upload" FilesChanged="UploadFiles" />
    }

    <hr style="margin-block: 2rem;" />

    <div class="w-100 d-flex justify-content-end mt-4">
        <MudButton StartIcon="@Icons.Material.Filled.AutoAwesome" 
                   Color="Color.Primary" 
                   Variant="Variant.Filled" 
                   Disabled="@_applicationGenerated"
                   OnClick="GenerateApplication">
            @(_applicationGenerated ? "Application Generated" : "Generate Application")
        </MudButton>
    </div>

    @if (_applicationGenerated)
    {
        <MudText Class="mt-4" Typo="Typo.body1" Color="Color.Success">
            ✅ Your application has been generated successfully!
        </MudText>
    }

}

@code {
    IList<IBrowserFile> _files = new List<IBrowserFile>();
    private bool _applicationGenerated = false;
    private string? _selectedSubtype;
    private bool _selectDisabled = false;
    private readonly string[] _subsidySubtypes =
    {
        "Crop sector",
        "Livestock sector",
        "Wine sector"
    };

    private void UploadFiles(IBrowserFile file)
    {
        _files.Add(file);
        //TODO upload the files to the server
    }

    private void GenerateApplication()
    {
        // TODO: Generate application logic here
        _applicationGenerated = true;
    }
}

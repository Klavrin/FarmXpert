<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <base href="/"/>
    <link rel="stylesheet" href="@Assets["lib/bootstrap/dist/css/bootstrap.min.css"]"/>
    <link rel="stylesheet" href="@Assets["app.css"]"/>
    <link rel="stylesheet" href="@Assets["FarmXpert.styles.css"]"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    <link href="@Assets["_content/MudBlazor/MudBlazor.min.css"]" rel="stylesheet" />
    <ImportMap/>
    <link rel="icon" type="image/png" href="favicon.png"/>
    <HeadOutlet/>
</head>

<body>
<Routes/>

<script src="_framework/blazor.web.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="@Assets["_content/MudBlazor/MudBlazor.min.js"]"></script>
<script>
    window.downloadFile = function (fileName, contentType, content) {
        // Create a blob from the base64 content
        const link = document.createElement('a');
        link.download = fileName;
        link.href = "data:" + contentType + ";base64," + content;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    };
</script>
<script>
    window.downloadFileAnotherFile = function (fileName, contentType, content) {
        const link = document.createElement('a');
        link.download = fileName;
        link.href = "data:" + contentType + ";base64," + content;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    };
</script>

<script>
    window.leafletMap = {
        map: null,
        markers: [],
        polygon: null,

        init: function (mapId, lat, lng, zoom) {
            this.map = L.map(mapId).setView([lat, lng], zoom);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(this.map);
        },

        locateUser: function () {
            this.map.locate({ setView: true, maxZoom: 17 });

            this.map.on('locationfound', e => {
                const marker = L.marker(e.latlng).addTo(this.map);
                this.markers.push(marker);
            });
        },

        enableLandDrawing: function (dotnetHelper) {
            const points = [];

            this.map.on('click', e => {
                points.push([e.latlng.lat, e.latlng.lng]);

                if (this.polygon) {
                    this.map.removeLayer(this.polygon);
                }

                this.polygon = L.polygon(points).addTo(this.map);

                dotnetHelper.invokeMethodAsync(
                    'ReceiveLandPoints',
                    JSON.stringify(points)
                );
            });
        }
    };
</script>

</body>
</html>